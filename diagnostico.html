<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Estado del Sistema - Juego de Peleas 2D</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid;
        }
        .status-success { border-left-color: #4CAF50; }
        .status-warning { border-left-color: #ff9800; }
        .status-error { border-left-color: #f44336; }
        .status-info { border-left-color: #2196F3; }
        
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #2196F3; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        
        .log {
            background: #000;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Sistema de Juego de Peleas 2D</h1>
            <p>Estado actual del sistema despu√©s de la refactorizaci√≥n masiva</p>
            <div id="lastUpdate">√öltima actualizaci√≥n: <span class="loading"></span></div>
        </div>

        <div class="status-grid" id="statusGrid">
            <!-- Los cards de estado se generar√°n din√°micamente -->
        </div>

        <div class="actions">
            <button class="btn btn-primary" onclick="testFullSystem()">üöÄ Probar Sistema Completo</button>
            <button class="btn btn-secondary" onclick="runDiagnostics()">üîç Ejecutar Diagn√≥sticos</button>
            <a href="/" class="btn btn-warning">üéÆ Ir al Juego</a>
            <button class="btn btn-secondary" onclick="clearLogs()">üßπ Limpiar Logs</button>
        </div>

        <div id="diagnosticLog" class="log" style="display: none;">
            <h3>üìã Log de Diagn√≥sticos:</h3>
            <div id="logContent"></div>
        </div>
    </div>

    <script type="module">
        let systemStatus = {
            gameManager: 'checking',
            performanceMonitor: 'checking',
            applicationController: 'checking',
            sceneManager: 'checking',
            authManager: 'checking',
            canvasElement: 'checking'
        };

        function updateStatusDisplay() {
            const grid = document.getElementById('statusGrid');
            const statusCards = Object.entries(systemStatus).map(([component, status]) => {
                const statusClass = status === 'ok' ? 'status-success' : 
                                   status === 'error' ? 'status-error' : 
                                   status === 'warning' ? 'status-warning' : 'status-info';
                
                const statusIcon = status === 'ok' ? '‚úÖ' : 
                                  status === 'error' ? '‚ùå' : 
                                  status === 'warning' ? '‚ö†Ô∏è' : 'üîÑ';
                
                const statusText = status === 'ok' ? 'Funcionando' : 
                                  status === 'error' ? 'Error' : 
                                  status === 'warning' ? 'Advertencia' : 'Verificando...';

                return `
                    <div class="status-card ${statusClass}">
                        <h3>${statusIcon} ${component.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</h3>
                        <p>Estado: <strong>${statusText}</strong></p>
                        <small>Componente del sistema refactorizado</small>
                    </div>
                `;
            }).join('');
            
            grid.innerHTML = statusCards;
        }

        function log(message) {
            const logDiv = document.getElementById('diagnosticLog');
            const logContent = document.getElementById('logContent');
            logDiv.style.display = 'block';
            
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
        }

        async function testFullSystem() {
            log('üöÄ Iniciando test completo del sistema...');
            
            try {
                // Test 1: Canvas Element
                log('üìã Test 1: Verificando elemento Canvas...');
                const canvas = document.getElementById('gameCanvas');
                if (canvas) {
                    systemStatus.canvasElement = 'ok';
                    log('‚úÖ Canvas encontrado correctamente');
                } else {
                    systemStatus.canvasElement = 'error';
                    log('‚ùå Canvas no encontrado - revisar index.html');
                }

                // Test 2: ApplicationController
                log('üìã Test 2: Importando ApplicationController...');
                const { default: ApplicationController } = await import('./src/application/ApplicationController.js');
                log('‚úÖ ApplicationController importado correctamente');
                
                const appController = new ApplicationController();
                log('‚úÖ ApplicationController instanciado');
                systemStatus.applicationController = 'ok';

                // Test 3: GameManager
                log('üìã Test 3: Verificando GameManager...');
                if (appController.gameManager) {
                    systemStatus.gameManager = 'ok';
                    log('‚úÖ GameManager creado correctamente');
                    
                    if (typeof appController.gameManager.setPerformanceMonitor === 'function') {
                        log('‚úÖ M√©todo setPerformanceMonitor disponible');
                    } else {
                        log('‚ö†Ô∏è M√©todo setPerformanceMonitor no encontrado');
                        systemStatus.gameManager = 'warning';
                    }
                } else {
                    systemStatus.gameManager = 'error';
                    log('‚ùå GameManager no creado');
                }

                // Test 4: PerformanceMonitor
                log('üìã Test 4: Verificando PerformanceMonitor...');
                if (appController.performanceMonitor) {
                    systemStatus.performanceMonitor = 'ok';
                    log('‚úÖ PerformanceMonitor creado correctamente');
                } else {
                    systemStatus.performanceMonitor = 'error';
                    log('‚ùå PerformanceMonitor no creado');
                }

                // Test 5: SceneManager
                log('üìã Test 5: Verificando SceneManager...');
                if (appController.sceneManager) {
                    systemStatus.sceneManager = 'ok';
                    log('‚úÖ SceneManager creado correctamente');
                } else {
                    systemStatus.sceneManager = 'error';
                    log('‚ùå SceneManager no creado');
                }

                // Test 6: AuthManager
                log('üìã Test 6: Verificando AuthManager...');
                if (appController.authManager) {
                    systemStatus.authManager = 'ok';
                    log('‚úÖ AuthManager creado correctamente');
                } else {
                    systemStatus.authManager = 'error';
                    log('‚ùå AuthManager no creado');
                }

                log('üéâ Test completo finalizado');
                
            } catch (error) {
                log(`‚ùå Error durante el test: ${error.message}`);
                console.error('Error en test:', error);
            }
            
            updateStatusDisplay();
            document.getElementById('lastUpdate').innerHTML = `√öltima actualizaci√≥n: ${new Date().toLocaleTimeString()}`;
        }

        async function runDiagnostics() {
            log('üîç Ejecutando diagn√≥sticos del sistema...');
            
            // Informaci√≥n del navegador
            log(`üåê Navegador: ${navigator.userAgent}`);
            log(`üìç URL actual: ${window.location.href}`);
            log(`üñ•Ô∏è Resoluci√≥n: ${window.screen.width}x${window.screen.height}`);
            log(`üíæ Memoria: ${performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB' : 'No disponible'}`);
            
            // Estado del DOM
            log(`üìÑ Estado del DOM: ${document.readyState}`);
            log(`üî¢ Elementos en DOM: ${document.querySelectorAll('*').length}`);
            
            await testFullSystem();
        }

        function clearLogs() {
            document.getElementById('logContent').innerHTML = '';
            document.getElementById('diagnosticLog').style.display = 'none';
        }

        // Hacer funciones globales
        window.testFullSystem = testFullSystem;
        window.runDiagnostics = runDiagnostics;
        window.clearLogs = clearLogs;

        // Auto-ejecutar diagn√≥sticos al cargar
        updateStatusDisplay();
        setTimeout(runDiagnostics, 1000);
    </script>
</body>
</html>
